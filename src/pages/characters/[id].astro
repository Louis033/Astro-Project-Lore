---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

export const prerender = true;

export async function getStaticPaths() {
  const entries = await getCollection("characters");
  return entries.map((entry) => ({
    params: { id: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

const base = import.meta.env.BASE_URL;
const withBase = (path) => `${base}${path}`;

// image di frontmatter: "images/characters/elias.png"
const imageSrc = entry.data.image ? withBase(entry.data.image) : null;
---

<BaseLayout title={entry.data.name ?? "Character"}>
  <a class="back" href={withBase("characters/")}>← Back to Characters</a>

  <h1>{entry.data.name}</h1>

  <div class="meta">
    {entry.data.title && <span><b>Title:</b> {entry.data.title}</span>}
    {entry.data.role && <span><b>Role:</b> {entry.data.role}</span>}
    {entry.data.affiliation && <span><b>Affiliation:</b> {entry.data.affiliation}</span>}
  </div>

  {imageSrc && (
    <figure class="portrait">
      <img
        src={imageSrc}
        alt={entry.data.name}
        width="220"
        height="220"
        loading="lazy"
        decoding="async"
      />
    </figure>
  )}

  <article class="prose">
    <Content />
  </article>
</BaseLayout>

<style>
  .back{
    display:inline-block;
    margin: 6px 0 18px;
    text-decoration:none;
  }
  .meta{
    display:flex;
    gap: 16px;
    flex-wrap: wrap;
    margin-bottom: 14px;
    opacity: .9;
  }
  .portrait{
    margin: 10px 0 18px;
  }
  .portrait img{
    width: 220px;         /* kunci biar ga “pecah” karena kebesaran */
    height: 220px;
    object-fit: cover;
    border-radius: 14px;
    border: 1px solid #eee;
    background: #fafafa;
    display:block;
  }
  .prose :global(h2){
    margin-top: 28px;
  }
</style>
