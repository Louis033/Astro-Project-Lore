---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const entries = await getCollection("characters");
  return entries.map((entry) => ({
    params: { id: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;

// Base URL aman untuk GitHub Pages
const base = import.meta.env.BASE_URL;
const withBase = (path) => `${base}${path}`;

// ambil image path dari frontmatter (optional)
const rawImage = entry.data.image ?? "";
const imagePath = rawImage.startsWith("/") ? rawImage.slice(1) : rawImage; // buang "/" kalau ada
const imageSrc = imagePath ? withBase(imagePath) : "";
---

<BaseLayout title={entry.data.name}>
  <a href={withBase("characters/")} style="display:inline-block; margin-bottom:16px;">← Back to Characters</a>

  <h1>{entry.data.name}</h1>

  <p class="meta">
    {entry.data.title && <> <strong>Title:</strong> {entry.data.title} </>}
    {entry.data.role && <> &nbsp; • &nbsp; <strong>Role:</strong> {entry.data.role} </>}
    {entry.data.affiliation && <> &nbsp; • &nbsp; <strong>Affiliation:</strong> {entry.data.affiliation} </>}
  </p>

  {imageSrc && (
    <img
      src={imageSrc}
      alt={entry.data.name}
      loading="lazy"
      decoding="async"
      class="heroimg"
    />
  )}

  <article class="content">
    <slot />
  </article>

  {/* kalau markdown kamu perlu dirender sebagai content, pakai ini: */}
  <article class="content">
    {entry.render().then((r) => r.Content)}
  </article>
</BaseLayout>

<style>
  .meta { opacity: .8; margin-bottom: 14px; }
  .heroimg{
    width: 100%;
    max-width: 520px;
    border-radius: 12px;
    border: 1px solid #eee;
    display: block;
    margin: 10px 0 18px;
  }
  .content{
    line-height: 1.8;
  }
</style>
